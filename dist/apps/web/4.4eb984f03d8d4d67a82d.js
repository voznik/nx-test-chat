(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{MEpA:function(e,t,s){"use strict";s.r(t),s.d(t,"ChatWrapperModule",(function(){return V}));var n=s("2kYt"),a=s("DLXF"),c=s("sEIs"),r=s("EM62"),i=s("Meci"),o=s("29Wa"),l=s("Cd2c"),u=s("nIj0"),b=s("PBFl"),m=s("Jb3d"),h=s("kAAd"),d=s("bFHC");function p(e,t){if(1&e){const e=r.Qb();r.Pb(0,"mat-grid-tile",10),r.Xb("click",(function(){r.lc(e);const s=t.$implicit;return r.Zb().onSmileClick(s)})),r.uc(1),r.Ob()}if(2&e){const e=t.$implicit;r.zb(1),r.vc(e)}}const g=function(){return{standalone:!0}};let f=(()=>{class e{constructor(){this.smiles=["\ud83d\ude42","\ud83d\ude43","\ud83d\ude02","\ud83d\ude19"],this.send=new r.n}onSmileClick(e){this.text=this.text+e}onSubmit(e){e.valid&&e.value.length&&e.value.length>=3&&(this.send.emit(e.value.trim()),e.reset())}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Eb({type:e,selectors:[["chat-form"]],inputs:{text:"text"},outputs:{send:"send"},decls:16,vars:6,consts:[["layout","row","layout-align","start center"],["flex","","layout","row","floatLabel","never","appearance","outline","hideRequiredMarker","true",1,"push-left","push-right"],["rows","1","flex","","matInput","","placeholder","Type your message, and hit Enter","name","text","minlength","3",3,"ngModel","ngModelOptions","ngModelChange","keydown.enter"],["t","ngModel"],["mat-button","","matTooltip","Add content","matTooltipPosition","after",3,"matMenuTriggerFor"],["chatMenu","matMenu"],["cols","2","rowHeight","2:1"],[3,"click",4,"ngFor","ngForOf"],["mat-icon-button","","matTooltip","Send","matTooltipPosition","after","type","submit",3,"disabled","click"],["matSuffix",""],[3,"click"]],template:function(e,t){if(1&e){const e=r.Qb();r.Pb(0,"mat-card"),r.Pb(1,"div",0),r.Pb(2,"mat-form-field",1),r.Pb(3,"textarea",2,3),r.Xb("ngModelChange",(function(e){return t.text=e}))("keydown.enter",(function(){r.lc(e);const s=r.jc(4);return t.onSubmit(s)})),r.Ob(),r.Ob(),r.Pb(5,"div"),r.Pb(6,"button",4),r.uc(7," \ud83d\ude42 "),r.Ob(),r.Pb(8,"mat-menu",null,5),r.Pb(10,"mat-grid-list",6),r.tc(11,p,2,1,"mat-grid-tile",7),r.Ob(),r.Ob(),r.Ob(),r.Pb(12,"div"),r.Pb(13,"button",8),r.Xb("click",(function(){r.lc(e);const s=r.jc(4);return t.onSubmit(s)})),r.Pb(14,"mat-icon",9),r.uc(15,"send"),r.Ob(),r.Ob(),r.Ob(),r.Ob(),r.Ob()}if(2&e){const e=r.jc(4),s=r.jc(9);r.zb(3),r.fc("ngModel",t.text)("ngModelOptions",r.hc(5,g)),r.zb(3),r.fc("matMenuTriggerFor",s),r.zb(5),r.fc("ngForOf",t.smiles),r.zb(2),r.fc("disabled",e.pristine||e.invalid)}},directives:[i.a,o.a,l.a,u.a,u.d,u.g,u.j,b.a,m.b,m.c,h.a,n.l,d.a,o.e,h.c],styles:[".mat-form-field-wrapper{padding-bottom:.25rem}"],encapsulation:2,changeDetection:0}),e})();var v=s("nKqi"),O=s("mFH5"),y=s("1a91");function S(e,t){if(1&e&&(r.Pb(0,"mat-list-item",5),r.Lb(1,"img",6),r.Pb(2,"h3",7),r.uc(3),r.Pb(4,"span",8),r.uc(5),r.ac(6,"date"),r.Ob(),r.Ob(),r.Pb(7,"div",9),r.Pb(8,"div",10),r.uc(9),r.Ob(),r.Ob(),r.Ob()),2&e){const e=t.$implicit;r.Cb("border-bottom",!t.last),r.zb(1),r.gc("src","https://api.adorable.io/avatars/285/",e.user.id||0,"@adorable.io.png",r.mc),r.zb(2),r.wc(" ",e.user.name||"Firstname Lastname"," "),r.zb(2),r.vc(r.cc(6,6,e.date,"shortTime")),r.zb(4),r.wc(" ",e.message," ")}}function k(e,t){1&e&&r.Lb(0,"td-message",11)}let w=(()=>{class e{constructor(){this.messages=null}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Eb({type:e,selectors:[["chat-list"]],inputs:{messages:"messages"},decls:5,vars:2,consts:[["flex","",1,"mat-content"],["fullscreen",""],[1,"pad-none"],["class","pad-top pad-bottom",3,"border-bottom",4,"ngFor","ngForOf"],["label","","sublabel","There are no messages in this chat room","color","primary","icon","info",4,"ngIf"],[1,"pad-top","pad-bottom"],["matListAvatar","",3,"src"],["matLine","",1,"cursor-pointer","tc-grey-700"],[1,"tc-grey-500","md-caption"],["matLine",""],[1,"text-wrap"],["label","","sublabel","There are no messages in this chat room","color","primary","icon","info"]],template:function(e,t){1&e&&(r.Pb(0,"div",0),r.Pb(1,"mat-card",1),r.Pb(2,"mat-list",2),r.tc(3,S,10,9,"mat-list-item",3),r.Ob(),r.tc(4,k,1,0,"td-message",4),r.Ob(),r.Ob()),2&e&&(r.zb(3),r.fc("ngForOf",t.messages),r.zb(1),r.fc("ngIf",!t.messages||!t.messages.length))},directives:[i.a,v.a,n.l,n.m,v.d,v.b,O.d,y.b],pipes:[n.e],styles:[""],encapsulation:2,changeDetection:0}),e})();var P=s("ZTXN");function M(e,t){if(1&e){const e=r.Qb();r.Pb(0,"a",4),r.Xb("dblclick",(function(t){r.lc(e);const s=r.Zb().$implicit;return r.Zb().onUserClick(t,s)})),r.Pb(1,"mat-icon",5),r.uc(2,"lens"),r.Ob(),r.Pb(3,"span",6),r.Lb(4,"img",7),r.uc(5),r.Ob(),r.Ob()}if(2&e){const e=r.Zb().$implicit;r.zb(4),r.gc("src","https://api.adorable.io/avatars/285/",e.id||0,"@adorable.io.png",r.mc),r.zb(1),r.wc(" ",e.name,"")}}function U(e,t){if(1&e&&(r.Nb(0),r.tc(1,M,6,2,"a",3),r.Mb()),2&e){const e=t.$implicit,s=r.Zb();r.zb(1),r.fc("ngIf",(null==s.currentUser?null:s.currentUser.name)!==e.name)}}function x(e,t){1&e&&r.Lb(0,"td-message",8)}let $=(()=>{class e{constructor(){this.users=[],this.userClicked=new r.n}ngOnInit(){}onUserClick(e,t){e.preventDefault(),this.userClicked.emit(t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Eb({type:e,selectors:[["chat-users"]],inputs:{currentUser:"currentUser",users:"users"},outputs:{userClicked:"userClicked"},decls:3,vars:2,consts:[["dense",""],[4,"ngFor","ngForOf"],["label","","sublabel","There'se no one exept you in this chat room","color","primary","icon","info",4,"ngIf"],["mat-list-item","",3,"dblclick",4,"ngIf"],["mat-list-item","",3,"dblclick"],["color","accent","matListIcon",""],["layout","row","layout-align","start center"],[1,"size-16","push-right-sm",3,"src"],["label","","sublabel","There'se no one exept you in this chat room","color","primary","icon","info"]],template:function(e,t){1&e&&(r.Pb(0,"mat-list",0),r.tc(1,U,2,1,"ng-container",1),r.Ob(),r.tc(2,x,1,0,"td-message",2)),2&e&&(r.zb(1),r.fc("ngForOf",t.users),r.zb(1),r.fc("ngIf",!t.users||1===t.users.length&&(null==t.currentUser?null:t.currentUser.name)===t.users[0].name))},directives:[v.a,n.l,n.m,v.d,d.a,v.c,y.b],styles:[""],changeDetection:0}),e})();var C=s("gJPw"),I=s("xVbo"),j=s("YtkY"),T=s("C05f"),z=s("KTx3");const E="chatUser";let F=(()=>{class e{constructor(){this.currentUser=new T.a(null),this.currentUser$=this.currentUser.asObservable(),this.storageEvents$=Object(z.a)(window,"storage").pipe(Object(I.a)(e=>e.storageArea===sessionStorage));const e=JSON.parse(window.sessionStorage.getItem(E));e&&this.currentUser.next(e)}getCurrentUserName(){return JSON.parse(window.sessionStorage.getItem(E)).name}enterChat(e){this.currentUser.next({name:e}),window.sessionStorage.setItem(E,JSON.stringify({name:e}))}exitChat(){this.currentUser.next(null),window.sessionStorage.removeItem(E)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=r.Gb({token:e,factory:e.\u0275fac}),e})();var L=s("vobO");let N=(()=>{class e{constructor(e,t,s){this.dataService=e,this.sessionService=t,this._http=s,this.chatMessages$=this.dataService.stream$.pipe(Object(I.a)(e=>"messages"===e.event),Object(j.a)(e=>e.data)),this.chatUsers$=this.dataService.stream$.pipe(Object(I.a)(e=>"users"===e.event),Object(j.a)(e=>e.data)),this.connection$=this.dataService.connection$,this.connectionOptions={reconnect:!1,queryParams:""}}connectSocket(){const e=this.sessionService.getCurrentUserName();this.connectionOptions.queryParams="chatUser="+e,this.dataService.connect(this.connectionOptions)}disconnectSocket(){const e=this.sessionService.getCurrentUserName();this.dataService.sendMessage("removeUser",e),this.sessionService.exitChat(),this.dataService.disconnect()}sendEvent(e){this.dataService.sendMessage(e)}sendChatMessage(e){this.dataService.sendMessage("chatMessage",e)}getUsers(){return this._http.get("/api/users")}}return e.\u0275fac=function(t){return new(t||e)(r.Tb(C.b),r.Tb(F),r.Tb(L.a))},e.\u0275prov=r.Gb({token:e,factory:e.\u0275fac}),e})();var X=s("ROBh"),A=s("J+dc"),J=s("TLy2");let K=(()=>{class e{constructor(e,t){this.router=e,this.sessionService=t}canActivate(e,t){return this.sessionService.currentUser$.pipe(Object(A.a)(1),Object(J.a)(e=>e?Object(X.a)(!0):(this.router.navigate(["/chat/enter"]),Object(X.a)(!1))))}}return e.\u0275fac=function(t){return new(t||e)(r.Tb(c.b),r.Tb(F))},e.\u0275prov=r.Gb({token:e,factory:e.\u0275fac}),e})();var _=s("l5H0");const H=function(){return{standalone:!0}};let B=(()=>{class e{constructor(e,t){this.sessionService=e,this.router=t,this.username=null}ngOnInit(){}sendUserInfo(e){e.valid&&e.value.length&&e.value.length>=3&&(this.sessionService.enterChat(e.value.trim()),e.reset(),this.router.navigate(["/chat/room"]))}}return e.\u0275fac=function(t){return new(t||e)(r.Kb(F),r.Kb(c.b))},e.\u0275cmp=r.Eb({type:e,selectors:[["test-chat-chat-login"]],decls:10,vars:4,consts:[["cardTitle","Welcome","cardSubtitle","Fill your username","cardWidth","30"],[1,"chat-login-form","pad"],["appearance","outline"],["flex","","matInput","","placeholder","Username (min 3 symbols)","name","username","required","","minlength","3",3,"ngModel","ngModelOptions","ngModelChange","keydown.enter"],["t","ngModel"],[1,"chat-login-footer","pad"],["type","submit","mat-button","","mat-stroked-button","",3,"disabled","click"]],template:function(e,t){if(1&e){const e=r.Qb();r.Pb(0,"td-layout-card-over",0),r.Pb(1,"div",1),r.Pb(2,"mat-form-field",2),r.Pb(3,"mat-label"),r.uc(4,"Username"),r.Ob(),r.Pb(5,"input",3,4),r.Xb("ngModelChange",(function(e){return t.username=e}))("keydown.enter",(function(){r.lc(e);const s=r.jc(6);return t.sendUserInfo(s)})),r.Ob(),r.Ob(),r.Ob(),r.Pb(7,"div",5),r.Pb(8,"button",6),r.Xb("click",(function(){r.lc(e);const s=r.jc(6);return t.sendUserInfo(s)})),r.uc(9," ENTER "),r.Ob(),r.Ob(),r.Ob()}if(2&e){const e=r.jc(6);r.zb(5),r.fc("ngModel",t.username)("ngModelOptions",r.hc(3,H)),r.zb(3),r.fc("disabled",e.pristine||e.invalid)}},directives:[_.b,o.a,o.d,l.a,u.a,u.l,u.d,u.g,u.j,b.a],styles:[""]}),e})();var D=s("g6G6"),Z=s("kuMc"),q=s("W1gw"),Q=s("lQ7A"),W=s("A7yd");const G=[{path:"room",component:(()=>{class e{constructor(e,t,s,n){this.chatService=e,this.sessionService=t,this.router=s,this._snackBar=n,this.currentUser=null,this.currentUserName="",this.messageInput="",this.connection$=this.chatService.connection$,this.users$=this.chatService.chatUsers$,this.messages$=this.chatService.chatMessages$,this.localMessages$=this.sessionService.storageEvents$.pipe(Object(I.a)(e=>"messages"===e.key),Object(j.a)(e=>JSON.parse(e.newValue))),this.__messages$=Object(D.a)(this.chatService.chatMessages$,this.localMessages$),this.destroy$=new P.b}ngOnInit(){this.sessionService.currentUser$.pipe(Object(Z.a)(this.destroy$)).subscribe(e=>this.currentUser=e),this.connection$.pipe(Object(Z.a)(this.destroy$)).subscribe(e=>this.openSnackBar(e?"Socket connected":"Socket disconnected")),this.chatService.connectSocket(),this.chatService.sendEvent("chat"),this.chatService.sendEvent("users")}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}userNameClicked(e){const t="@"+e.name;this.messageInput&&this.messageInput.includes(t)||(this.messageInput=this.messageInput+t+" ")}sendMessage(e){this.chatService.sendChatMessage({message:e,user:this.currentUser}),this.messageInput=null}exitChat(){this.chatService.disconnectSocket(),this.router.navigate(["/chat/enter"])}openSnackBar(e){this._snackBar.open(e,"OK",{duration:1e3})}}return e.\u0275fac=function(t){return new(t||e)(r.Kb(N),r.Kb(F),r.Kb(c.b),r.Kb(q.a))},e.\u0275cmp=r.Eb({type:e,selectors:[["ng-component"]],decls:20,vars:8,consts:[["fullscreen",""],["opened","","mode","side","position","end",1,"chat-sidenav"],["sidenav",""],["layout","column","layout-fill","",1,"chat-aside"],[3,"currentUser","users","userClicked"],[1,"chat-bottom-toolbar"],[1,"spacer"],["mat-icon-button","","aria-label","Example icon-button with share icon",1,"example-icon",3,"click"],["layout","column","layout-fill","",1,"chat-main"],[3,"messages"],[3,"text","send"]],template:function(e,t){1&e&&(r.Pb(0,"mat-sidenav-container",0),r.Pb(1,"mat-sidenav",1,2),r.Pb(3,"div",3),r.Pb(4,"chat-users",4),r.Xb("userClicked",(function(e){return t.userNameClicked(e)})),r.ac(5,"async"),r.Ob(),r.Pb(6,"div",5),r.Pb(7,"mat-toolbar"),r.Pb(8,"mat-toolbar-row"),r.Pb(9,"span"),r.uc(10,"Users"),r.Ob(),r.Lb(11,"span",6),r.Pb(12,"button",7),r.Xb("click",(function(){return t.exitChat()})),r.Pb(13,"mat-icon"),r.uc(14,"exit_to_app"),r.Ob(),r.Ob(),r.Ob(),r.Ob(),r.Ob(),r.Ob(),r.Ob(),r.Pb(15,"mat-sidenav-content"),r.Pb(16,"div",8),r.Lb(17,"chat-list",9),r.ac(18,"async"),r.Pb(19,"chat-form",10),r.Xb("send",(function(e){return t.sendMessage(e)})),r.Ob(),r.Ob(),r.Ob(),r.Ob()),2&e&&(r.zb(4),r.fc("currentUser",t.currentUser)("users",r.bc(5,4,t.users$)),r.zb(13),r.fc("messages",r.bc(18,6,t.messages$)),r.zb(2),r.fc("text",t.messageInput))},directives:[Q.b,Q.a,$,W.a,W.c,b.a,d.a,Q.c,w,f],pipes:[n.b],styles:[".chat-aside,.chat-main{min-height:100%;display:flex;flex-direction:column;align-items:stretch}.chat-aside chat-list,.chat-aside chat-users,.chat-main chat-list,.chat-main chat-users{flex-grow:1}.chat-aside chat-form,.chat-main chat-form{flex-shrink:0}.chat-aside .spacer,.chat-main .spacer{flex:1 1 auto}"],encapsulation:2}),e})(),canActivate:[K]},{path:"enter",component:B},{path:"",redirectTo:"room",pathMatch:"full"}];let R=(()=>{class e{}return e.\u0275mod=r.Ib({type:e}),e.\u0275inj=r.Hb({factory:function(t){return new(t||e)},imports:[[c.d.forChild(G)]]}),e})(),Y=(()=>{class e{}return e.\u0275mod=r.Ib({type:e}),e.\u0275inj=r.Hb({factory:function(t){return new(t||e)},providers:[N,K,F],imports:[[n.c,R,a.a]]}),e})(),V=(()=>{class e{}return e.\u0275mod=r.Ib({type:e}),e.\u0275inj=r.Hb({factory:function(t){return new(t||e)},imports:[[Y]]}),e})()}}]);